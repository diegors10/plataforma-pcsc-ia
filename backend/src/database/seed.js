import bcrypt from 'bcryptjs';
import prisma from '../config/database.js';

async function main() {
  console.log('üå± Iniciando seed do banco de dados...');

  try {
    // Criar especialidades
    const especialidades = await Promise.all([
      prisma.especialidades.upsert({
        where: { nome: 'Investiga√ß√£o Digital' },
        update: {},
        create: {
          nome: 'Investiga√ß√£o Digital',
          descricao: 'An√°lise forense digital, evid√™ncias eletr√¥nicas e crimes cibern√©ticos',
          icone: 'computer',
          cor: '#3B82F6'
        }
      }),
      prisma.especialidades.upsert({
        where: { nome: 'An√°lise Criminal' },
        update: {},
        create: {
          nome: 'An√°lise Criminal',
          descricao: 'An√°lise de padr√µes criminais, intelig√™ncia policial e investiga√ß√£o',
          icone: 'search',
          cor: '#EF4444'
        }
      }),
      prisma.especialidades.upsert({
        where: { nome: 'Documenta√ß√£o' },
        update: {},
        create: {
          nome: 'Documenta√ß√£o',
          descricao: 'Elabora√ß√£o de relat√≥rios, documentos oficiais e procedimentos',
          icone: 'file-text',
          cor: '#10B981'
        }
      }),
      prisma.especialidades.upsert({
        where: { nome: 'Procedimentos Operacionais' },
        update: {},
        create: {
          nome: 'Procedimentos Operacionais',
          descricao: 'Protocolos policiais, opera√ß√µes e procedimentos de campo',
          icone: 'shield',
          cor: '#F59E0B'
        }
      })
    ]);

    console.log('‚úÖ Especialidades criadas:', especialidades.length);

    // Criar usu√°rio administrador
    const hashedPassword = await bcrypt.hash('admin123', 12);
    
    const adminUser = await prisma.usuarios.upsert({
      where: { email: 'admin@pcsc.sc.gov.br' },
      update: {},
      create: {
        email: 'admin@pcsc.sc.gov.br',
        nome: 'Administrador do Sistema',
        senha: hashedPassword,
        departamento: 'Tecnologia da Informa√ß√£o',
        cargo: 'Administrador de Sistema',
        matricula: 'ADM001',
        e_admin: true,
        e_moderador: true,
        esta_ativo: true
      }
    });

    console.log('‚úÖ Usu√°rio administrador criado:', adminUser.email);

    // Criar usu√°rios de exemplo
    const usuarios = await Promise.all([
      prisma.usuarios.upsert({
        where: { email: 'investigador.silva@pcsc.sc.gov.br' },
        update: {},
        create: {
          email: 'investigador.silva@pcsc.sc.gov.br',
          nome: 'Jo√£o Silva',
          senha: await bcrypt.hash('senha123', 12),
          departamento: 'Investiga√ß√£o Criminal',
          cargo: 'Investigador',
          matricula: 'INV001',
          telefone: '(48) 99999-0001',
          localizacao: 'Florian√≥polis/SC',
          biografia: 'Especialista em crimes digitais com 10 anos de experi√™ncia.'
        }
      }),
      prisma.usuarios.upsert({
        where: { email: 'delegada.santos@pcsc.sc.gov.br' },
        update: {},
        create: {
          email: 'delegada.santos@pcsc.sc.gov.br',
          nome: 'Maria Santos',
          senha: await bcrypt.hash('senha123', 12),
          departamento: 'Delegacia Especializada',
          cargo: 'Delegada',
          matricula: 'DEL001',
          telefone: '(48) 99999-0002',
          localizacao: 'Joinville/SC',
          biografia: 'Delegada especializada em crimes contra o patrim√¥nio.',
          e_moderador: true
        }
      })
    ]);

    console.log('‚úÖ Usu√°rios de exemplo criados:', usuarios.length);

    // Criar prompts de exemplo
    const prompts = await Promise.all([
      prisma.prompts.create({
        data: {
          titulo: 'An√°lise de Evid√™ncias Digitais em Dispositivos M√≥veis',
          descricao: 'Prompt para an√°lise sistem√°tica de evid√™ncias digitais em smartphones e tablets, incluindo recupera√ß√£o de dados deletados e an√°lise de aplicativos.',
          conteudo: `Voc√™ √© um especialista em an√°lise forense digital. Analise as evid√™ncias digitais encontradas no dispositivo m√≥vel seguindo estas diretrizes:

1. **Identifica√ß√£o do Dispositivo**
   - Modelo, marca e sistema operacional
   - N√∫mero IMEI e informa√ß√µes de rede
   - Estado f√≠sico do dispositivo

2. **Extra√ß√£o de Dados**
   - Contatos e agenda telef√¥nica
   - Mensagens SMS e aplicativos de mensagem
   - Hist√≥rico de chamadas
   - Fotos, v√≠deos e arquivos de m√≠dia
   - Dados de localiza√ß√£o e GPS
   - Hist√≥rico de navega√ß√£o

3. **An√°lise de Aplicativos**
   - WhatsApp, Telegram, Instagram, Facebook
   - Aplicativos banc√°rios e de pagamento
   - Aplicativos de transporte e entrega
   - Jogos e entretenimento

4. **Recupera√ß√£o de Dados Deletados**
   - T√©cnicas de recupera√ß√£o
   - Valida√ß√£o da integridade dos dados
   - Timeline de atividades

5. **Documenta√ß√£o e Relat√≥rio**
   - Cadeia de cust√≥dia
   - Metodologia utilizada
   - Achados relevantes para a investiga√ß√£o
   - Conclus√µes t√©cnicas

Mantenha sempre a integridade das evid√™ncias e documente todos os procedimentos realizados.`,
          categoria: 'Investiga√ß√£o Digital',
          tags: ['forense', 'digital', 'm√≥vel', 'evid√™ncias'],
          e_publico: true,
          foi_aprovado: true,
          e_destaque: true,
          visualizacoes: 245,
          autor_id: usuarios[0].id,
          especialidade_id: especialidades[0].id
        }
      }),
      prisma.prompts.create({
        data: {
          titulo: 'Reda√ß√£o de Relat√≥rio de Investiga√ß√£o Policial',
          descricao: 'Template estruturado para elabora√ß√£o de relat√≥rios de investiga√ß√£o claros, objetivos e tecnicamente corretos.',
          conteudo: `Para redigir um relat√≥rio de investiga√ß√£o policial eficaz, siga esta estrutura:

## 1. IDENTIFICA√á√ÉO
- N√∫mero do inqu√©rito/procedimento
- Delegacia respons√°vel
- Autoridade policial
- Data e hor√°rio

## 2. RESUMO EXECUTIVO
- S√≠ntese dos fatos investigados
- Principais conclus√µes
- Autoria e materialidade

## 3. DOS FATOS
- Narrativa cronol√≥gica dos eventos
- Circunst√¢ncias do crime
- Local, data e hor√°rio
- V√≠timas e testemunhas

## 4. DA INVESTIGA√á√ÉO
### 4.1 Dilig√™ncias Realizadas
- Oitivas de testemunhas
- Interrogat√≥rios
- Per√≠cias t√©cnicas
- Buscas e apreens√µes

### 4.2 Evid√™ncias Coletadas
- Provas materiais
- Documentos
- Registros eletr√¥nicos
- Laudos periciais

## 5. AN√ÅLISE T√âCNICA
- Correla√ß√£o das evid√™ncias
- An√°lise da autoria
- Comprova√ß√£o da materialidade
- Circunst√¢ncias agravantes/atenuantes

## 6. CONCLUS√ÉO
- Tipifica√ß√£o penal
- Indiciamento (se aplic√°vel)
- Recomenda√ß√µes

## 7. ANEXOS
- Documentos probat√≥rios
- Fotografias
- Laudos t√©cnicos
- Depoimentos

Utilize linguagem t√©cnica, objetiva e imparcial. Fundamente todas as conclus√µes em evid√™ncias concretas.`,
          categoria: 'Documenta√ß√£o',
          tags: ['relat√≥rio', 'investiga√ß√£o', 'documenta√ß√£o', 'procedimentos'],
          e_publico: true,
          foi_aprovado: true,
          e_destaque: true,
          visualizacoes: 189,
          autor_id: usuarios[1].id,
          especialidade_id: especialidades[2].id
        }
      }),
      prisma.prompts.create({
        data: {
          titulo: 'An√°lise de Padr√µes em Crimes Seriados',
          descricao: 'Metodologia para identifica√ß√£o de padr√µes e conex√µes em s√©ries de crimes usando t√©cnicas de an√°lise criminal.',
          conteudo: `Para identificar padr√µes em crimes seriados, utilize esta metodologia de an√°lise:

## COLETA DE DADOS
1. **Informa√ß√µes B√°sicas**
   - Data, hor√°rio e local dos crimes
   - Tipo de crime e modus operandi
   - Caracter√≠sticas das v√≠timas
   - Evid√™ncias f√≠sicas coletadas

2. **An√°lise Geogr√°fica**
   - Mapeamento dos locais dos crimes
   - Identifica√ß√£o de clusters geogr√°ficos
   - An√°lise de rotas e deslocamentos
   - Pontos de ancoragem do criminoso

## AN√ÅLISE DE PADR√ïES
1. **Temporal**
   - Dias da semana preferenciais
   - Hor√°rios de maior incid√™ncia
   - Intervalos entre os crimes
   - Sazonalidade

2. **Comportamental**
   - Modus operandi consistente
   - Assinatura criminal
   - Evolu√ß√£o do comportamento
   - Rituais espec√≠ficos

3. **Vitimol√≥gico**
   - Perfil das v√≠timas
   - Crit√©rios de sele√ß√£o
   - Vulnerabilidades exploradas
   - Rela√ß√£o autor-v√≠tima

## FERRAMENTAS DE AN√ÅLISE
- Software de an√°lise criminal
- Sistemas de mapeamento
- Bancos de dados criminais
- An√°lise estat√≠stica

## RELAT√ìRIO DE AN√ÅLISE
1. Resumo dos padr√µes identificados
2. Probabilidade de autoria comum
3. Previs√µes de comportamento futuro
4. Recomenda√ß√µes investigativas

Esta an√°lise deve ser cont√≠nua e atualizada conforme novos crimes s√£o descobertos.`,
          categoria: 'An√°lise Criminal',
          tags: ['padr√µes', 'an√°lise', 'crimes seriados', 'investiga√ß√£o'],
          e_publico: true,
          foi_aprovado: true,
          visualizacoes: 156,
          autor_id: adminUser.id,
          especialidade_id: especialidades[1].id
        }
      })
    ]);

    console.log('‚úÖ Prompts de exemplo criados:', prompts.length);

    // Criar algumas curtidas
    await Promise.all([
      prisma.curtidas.create({
        data: {
          usuario_id: usuarios[1].id,
          prompt_id: prompts[0].id
        }
      }),
      prisma.curtidas.create({
        data: {
          usuario_id: adminUser.id,
          prompt_id: prompts[0].id
        }
      }),
      prisma.curtidas.create({
        data: {
          usuario_id: usuarios[0].id,
          prompt_id: prompts[1].id
        }
      })
    ]);

    console.log('‚úÖ Curtidas de exemplo criadas');

    // Criar coment√°rios de exemplo
    const comentarios = await Promise.all([
      prisma.comentarios.create({
        data: {
          conteudo: 'Excelente prompt! Muito √∫til para padronizar nossas an√°lises forenses.',
          autor_id: usuarios[1].id,
          prompt_id: prompts[0].id,
          foi_aprovado: true
        }
      }),
      prisma.comentarios.create({
        data: {
          conteudo: 'Poderia incluir tamb√©m an√°lise de dados em nuvem?',
          autor_id: adminUser.id,
          prompt_id: prompts[0].id,
          foi_aprovado: true
        }
      })
    ]);

    // Criar resposta ao coment√°rio
    await prisma.comentarios.create({
      data: {
        conteudo: 'Boa sugest√£o! Vou incluir uma se√ß√£o sobre an√°lise de dados em nuvem na pr√≥xima vers√£o.',
        autor_id: usuarios[0].id,
        prompt_id: prompts[0].id,
        comentario_pai_id: comentarios[1].id,
        foi_aprovado: true
      }
    });

    console.log('‚úÖ Coment√°rios de exemplo criados');

    console.log('üéâ Seed conclu√≠do com sucesso!');
    console.log('\nüìä Dados criados:');
    console.log(`- ${especialidades.length} especialidades`);
    console.log(`- ${usuarios.length + 1} usu√°rios (incluindo admin)`);
    console.log(`- ${prompts.length} prompts`);
    console.log('- 3 curtidas');
    console.log('- 3 coment√°rios');
    
    console.log('\nüë§ Credenciais do administrador:');
    console.log('Email: admin@pcsc.sc.gov.br');
    console.log('Senha: admin123');

  } catch (error) {
    console.error('‚ùå Erro durante o seed:', error);
    throw error;
  }
}

main()
  .catch((e) => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
